    @using Utilities
    @using Utilities.Contants
    @using Entities.ViewModels
    @model List<ChapterViewModel>



@* <section class="main-container clearfix">



    <!-- Danh sách Chapter -->
    <div id="chapter-list">
        @if (Model != null && Model.Count > 0)
        {
            foreach (var chapter in Model)
            {
                <!-- Chapter Item -->
                <div class="block-course accordion chapter-item" id="chapter-@chapter.Id">
                    <div class="item">
                        <div class="title" id="heading-@chapter.Id">
                            <a data-toggle="collapse" data-target="#collapse-@chapter.Id">
                                <input class="form-control" style="width:80%" type="text" value="@chapter.Title" readonly />
                                <span class="time">
                                    @($"{chapter.Lessons?.Count ?? 0} bài giảng")
                                </span>
                            </a>
                        </div>
                        <!-- Lesson List -->
                        <div id="collapse-@chapter.Id" class="collapse show" aria-labelledby="heading-@chapter.Id" data-parent="#chapter-list">
                            <div class="card-body">
                                <ul id="lesson-list-@chapter.Id" class="sortable">
                                    @if (chapter.Lessons != null && chapter.Lessons.Count > 0)
                                    {
                                        foreach (var lesson in chapter.Lessons)
                                        {
                                            var fileExtension = System.IO.Path.GetExtension(lesson.Thumbnail)?.ToLower();
                                            <li class="ui-state-default lesson-item" id="lesson-@lesson.Id">
                                                <div class="d-flex align-items-center">
                                                    <!-- Icon mở file/video -->
                                                    @if (fileExtension == ".mp4")
                                                    {
                                                        <img class="lesson-icon"
                                                             data-url="@lesson.Thumbnail"
                                                             style="font-size: 24px; cursor: pointer;" src="/images/icons/PlayCircle.svg">

                                                    }
                                                    else if (fileExtension == ".pdf")
                                                    {
                                                        <img class="lesson-icon"
                                                             data-url="@lesson.Thumbnail"
                                                             style="font-size: 24px; cursor: pointer;" src="/images/icons/BookOpenText.svg">
                                                    }

                                                    <!-- Lesson Title -->
                                                    <span class="flex-tt ml-2">
                                                        <input class="form-control lesson-title" type="text" value="@lesson.Title" readonly />
                                                    </span>


                                                </div>
                                                <span class="time">@lesson.VideoDuration</span>
                                            </li>
                                        }
                                    }
                                    else
                                    {
                                        <li>Không có bài giảng nào.</li>
                                    }


                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <p>Chưa có tiết học nào được thêm.</p>
        }
    </div>

    <!-- Nút Thêm Tiết Học -->
    <a href="#edit-khoahoc-popup" class="open-popup btn btn-default orange line dashed round mb-3 mt-3" id="btn-add-chapter">Thêm Tiết Học</a>
</section> *@

    <section class="main-container clearfix">
        <div id="chapter-list">
            @if (Model != null && Model.Count > 0)
            {
                <div style="max-width:100%">
                    <div class="line-bottom">
                        <h2>Chương trình giảng dạy</h2>
                    </div>

                    <div class="box-thongtin">
                        <p>
                            Hãy bắt đầu xây dựng khóa học của bạn bằng cách tạo các phần, bài giảng và bài thực hành
                            (<a href="" class="text-primary">trắc nghiệm và bài tập</a>).
                            Sử dụng <a href="" class="text-primary">đề cương khóa học</a> của
                            bạn để cấu trúc nội dung của bạn và gắn nhãn
                            các phần và bài giảng của bạn một cách rõ ràng. Nếu bạn định cung cấp khóa học miễn phí, tổng
                            thời lượng của nội dung video phải dưới 2 giờ.
                        </p>

                        @foreach (var chapter in Model.Where(c => c.IsDelete == 0))
                        {
                            <div class="block-chap block-item" data-item-id="@chapter.Id" data-item-type="Chapter">
                                <div class="item-header">
                                    <h6>
                                        <span class="tt-phan">Phần @chapter.Id:</span>
                                        <span class="item-title">@chapter.Title</span>
                                        <a href="javascript:void(0)" class="btn-edit-item" data-item-id="@chapter.Id" data-item-type="Chapter">
                                            <i class="icofont-ui-edit edit"></i>
                                        </a>
                                        <a href="javascript:void(0)" class="btn-delete-item" data-item-id="@chapter.Id" data-item-type="Chapter">
                                            <i class="icofont-trash del"></i>
                                        </a>
                                    </h6>
                                </div>

                                <div class="item-content">
                                    <!-- Form sửa sẽ được thêm động tại đây -->
                                </div>

                                @foreach (var lesson in chapter.Lessons.Where(l => l.IsDelete == 0))
                                {
                                    <div class="box-add-chap block-item" data-item-id="@lesson.Id" data-item-type="Lesson" data-parent-id="@chapter.Id">
                                  
                                        <div class="lesson-block" id="lesson_@lesson.Id">

                                            <div class="lesson-item">
                                                <div class="lesson-header title-block txt_16 mb-0 justify-content-between w-100">
                                                    <div class="lesson-info">
                                                        <i class="icofont-check-circled mt-1 mr-2"></i>
                                                        <span class="text-nowrap">Bài giảng @lesson.Id:</span>
                                                        <span class="item-title"><i class="icofont-file-alt mr-2"></i>@lesson.Title</span>
                                                        <a href="javascript:void(0)" class="btn-edit-item" data-item-id="@lesson.Id" data-item-type="Lesson">
                                                            <i class="icofont-ui-edit edit"></i>
                                                        </a>
                                                        <a href="javascript:void(0)" class="btn-delete-item" data-item-id="@lesson.Id" data-item-type="Lesson">
                                                            <i class="icofont-trash del"></i>
                                                        </a>
                                                    </div>
                                                    <div class="action-buttons">
                                                        <span class="btn btn-default white min2 btn-toggle-content">
                                                            <i class="icofont-plus mr-2"></i>Nội dung
                                                        </span>
                                                    <button type="button" class="btn-chevron" onclick="toggleContent('lesson_@lesson.Id')">
                                                        <i class="icofont-rounded-down"></i>
                                                    </button>
                                                        <i class="icofont-navigation-menu move"></i>
                                                    </div>
                                                </div>
                                                <div class="lesson-content" style="display: none;">

                                                <div class="common-panel" data-current-panel="default">
                                                    <!-- Nội dung mặc định (Mô tả và Tài nguyên) -->
                                                    <div class="panel-default">
                                                        <button class="btn-action btn-description">
                                                            <i class="icofont-plus"></i>
                                                            Mô tả
                                                        </button>
                                                        <button class="btn-action btn-resource">
                                                            <i class="icofont-plus"></i>
                                                            Tài nguyên
                                                        </button>
                                                    </div>

                                                    <!-- Panel Nội dung -->
                                                    <div class="panel-content" style="display: none;">
                                                        <div class="content-options">
                                                            <div class="option-box" data-type="video">
                                                                <i class="icofont-play-alt-1 icon-lg"></i>
                                                                <span>Video</span>
                                                            </div>
                                                            <div class="option-box">
                                                                <i class="icofont-file-powerpoint icon-lg"></i>
                                                                <span>Bài giảng kết hợp video & trình bày</span>
                                                            </div>
                                                            <div class="option-box">
                                                                <i class="icofont-file-text icon-lg"></i>
                                                                <span>Bài viết</span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Panel Upload Video -->
                                                    <div class="panel-upload-video" style="display: none;">
                                                        <h5>Thêm Video</h5>
                                                        <div class="custom-file">
                                                            <input type="file" class="custom-file-input auto-upload" id="lessonFile_@lesson.Id" name="attachFiles" data-lesson-id="@lesson.Id" multiple>
                                                            <label class="custom-file-label" for="lessonFile_@lesson.Id">Không có file nào được chọn</label>
                                                        </div>
                                                    </div>

                                                </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Panel chọn nội dung -->
                                        <div class="content-panel" style="display: none;">
                                            <div class="content-options">
                                                <div class="option-box" data-type="video">
                                                    <i class="icofont-play-alt-1 icon-lg"></i>
                                                    <span>Video</span>
                                                </div>
                                                <div class="option-box">
                                                    <i class="icofont-file-powerpoint icon-lg"></i>
                                                    <span>Bài giảng kết hợp video & trình bày</span>
                                                </div>
                                                <div class="option-box">
                                                    <i class="icofont-file-text icon-lg"></i>
                                                    <span>Bài viết</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Panel upload video -->
                                        <div class="video-upload-panel" style="display: none;">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <h5>Thêm Video</h5>
                                                <button type="button" class="btn-close">
                                                    <i class="icofont-close"></i>
                                                </button>
                                            </div>
                                            <div class="tab-default mt-2">
                                                <a href="#" class="active">File có thể tải xuống</a>
                                            </div>

                                            <div class="custom-file">
                                                <input type="file" class="custom-file-input auto-upload" id="lessonFile_@lesson.Id" name="attachFiles" data-lesson-id="@lesson.Id" multiple>
                                                <label class="custom-file-label" for="lessonFile_@lesson.Id">Không có file nào được chọn</label>
                                            </div>

                                            <div class="upload-progress mt-2" style="display: none;">
                                                <div class="progress">
                                                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%;" aria-valuemin="0" aria-valuemax="100"></div>
                                                </div>
                                            </div>
                                            <p class="color-gray mt-2">
                                                Lưu ý: Tài nguyên áp dụng cho bất kỳ loại tài liệu nào có thể dùng để trợ giúp
                                                học viên khi họ nghe giảng. File này sẽ được coi là bài giảng bổ sung. Hãy đảm
                                                bảo rằng nội dung tài nguyên rõ ràng, dễ đọc và có kích thước file dưới 200Mb.
                                                Chấp nhận định dạng: mp3, pdf, audio, jpg, mp4
                                            </p>

                                        </div>

                                        <div class="item-content2">
                                            <table class="file-list-table">
                                                <thead>
                                                    <tr>
                                                        <th>Tên file</th>
                                                        <th>Loại</th>
                                                        <th>Kích thước</th>
                                                        <th>Ngày</th>

                                                    </tr>
                                                </thead>
                                                <tbody id="fileList_@lesson.Id">
                                                    @if (lesson.Files != null && lesson.Files.Count > 0)
                                                    {
                                                        foreach (var file in lesson.Files)
                                                        {
                                                            <tr>
                                                                <td>@file.Path</td>
                                                                <td>@file.Ext</td>
                                                                <td>@(file.Capacity / 1024) KB</td>
                                                                <td>@file.CreateDate</td>

                                                            </tr>
                                                        }
                                                    }
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="item-content">
                                            <!-- Form sửa sẽ được thêm động tại đây -->
                                        </div>
                                    </div>
                                }

                                <div class="box-add-chap p-0 border-0 bg-transparent">
                                    <a href="javascript:void(0)" class="btn btn-default btn-add-content" data-parent-id="@chapter.Id">
                                        <i class="icofont-plus mr-2"></i>Mục trong khung chương trình
                                    </a>
                                    <div class="content-options" style="display: none; margin-top: 10px;">
                                        <a href="javascript:void(0)" class="text-primary btn-add-type" data-type="Lesson" data-parent-id="@chapter.Id">
                                            <i class="icofont-plus mr-2"></i>Bài giảng
                                        </a>
                                        <a href="javascript:void(0)" class="text-primary btn-add-type" data-type="Quiz" data-parent-id="@chapter.Id">
                                            <i class="icofont-plus mr-2"></i>Trắc nghiệm
                                        </a>
                                    </div>
                                </div>
                            </div>
                        }

                        <button type="button" class="btn btn-primary btn-add-type" data-type="Chapter">
                            <i class="icofont-plus mr-2"></i>Phần
                        </button>
                    </div>
                </div>
            }
            else
            {
                <p>Chưa có tiết học nào được thêm.</p>
            }
        </div>
    </section>

<style>
    .lesson-item {
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        margin-bottom: 8px;
    }

    .lesson-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
    }

    .lesson-info {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .title-actions {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .edit-btn, .delete-btn {
        color: #6b7280;
        text-decoration: none;
    }

    .action-buttons {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .btn-content {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 16px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        background: white;
        color: #6b7280;
        font-size: 14px;
        cursor: pointer;
    }

    .btn-chevron {
        padding: 4px;
        border: none;
        background: transparent;
        cursor: pointer;
    }

        .btn-chevron i {
            font-size: 20px;
            color: #6b7280;
            transition: transform 0.2s;
        }

        .btn-chevron.active i {
            transform: rotate(180deg);
        }

    .lesson-content {
        padding: 12px 16px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        gap: 8px;
    }

    .btn-action {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border: 1px solid #6366f1;
        border-radius: 6px;
        background: transparent;
        color: #6366f1;
        font-size: 14px;
        cursor: pointer;
    }

    .icofont-navigation-menu {
        color: #6b7280;
        cursor: move;
    }


    .content-options {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin: 20px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 4px;
    }

    .option-box {
        width: 120px;
        height: 90px;
        background-color: white;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        padding: 10px;
        transition: all 0.2s;
    }

        .option-box:hover {
            background-color: #f8f9fa;
            border-color: #adb5bd;
        }

    .icon-lg {
        font-size: 24px;
        margin-bottom: 8px;
    }

    .upload-tabs {
        display: flex;
        gap: 20px;
        border-bottom: 1px solid #dee2e6;
        margin-bottom: 20px;
    }

    .upload-tab {
        padding: 8px 0;
        cursor: pointer;
        color: #6c757d;
        position: relative;
    }

        .upload-tab.active {
            color: #0d6efd;
        }

            .upload-tab.active:after {
                content: '';
                position: absolute;
                bottom: -1px;
                left: 0;
                right: 0;
                height: 2px;
                background: #0d6efd;
            }

    .file-upload-area {
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 15px;
    }

    .btn-close {
        background: none;
        border: none;
        font-size: 20px;
        padding: 0;
        cursor: pointer;
    }

    .video-upload-panel {
        padding: 20px;
        background: white;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .content-panel, .video-upload-panel {
        margin: 15px;
    }
</style>






<!-- Popup Thêm/Sửa Chapter -->
@* <div id="edit-khoahoc-popup" class="edit-khoahoc-popup white-popup mfp-hide">
    <div class="content_lightbox">
        <div class="header">
            <h4 class="modal-title text-uppercase mb-3" id="popup-title">Thêm tiết học</h4>
            <button title="Close (Esc)" type="button" class="mfp-close"></button>
        </div>
        <div class="content">
            <div class="block-course accordion" id="popup-chapter-list">
                <div class="item">
                    <div class="title title-add">
                        <input class="form-control new-chapter-title" type="text" placeholder="Thêm tiết học" />
                    </div>
                </div>
            </div>
        </div>
        <div class="form-default">
            <div class="flex align-items-center justify-end mt20 gap10">
                <button type="button" class="btn btn-default none mfp-close round" style="margin: 0px 120px;">
                    Hủy
                </button>
                <button type="button" id="save-chapters" class="btn btn-default orange round">Xác nhận</button>
            </div>
        </div>
    </div>
</div> *@


